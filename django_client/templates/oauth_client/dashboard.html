{% extends 'base.html' %}

{% block title %}Dashboard - Picard MCP Client{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2>User Dashboard</h2>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">OAuth Status</h5>
            </div>
            <div class="card-body">
                {% if has_token %}
                <div class="alert alert-success">
                    <p><strong>Connected to MCP Server</strong></p>
                    <p>Your account is connected to the MCP server.</p>
                    <p>Token expires at: {{ token.expires_at }}</p>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <p><strong>Not Connected to MCP Server</strong></p>
                    <p>Your account is not connected to the MCP server.</p>
                </div>
                {% endif %}
                
                <div class="d-grid gap-2">
                    {% if has_token %}
                    <button id="refresh-token" class="btn btn-primary">Refresh Token</button>
                    {% else %}
                    <a href="{% url 'oauth_authorize' %}" class="btn btn-primary">Connect to MCP Server</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'memory_list' %}" class="btn btn-info">View Memories</a>
                    <a href="{% url 'create_memory' %}" class="btn btn-success">Create Memory</a>
                    <a href="{% url 'query_user' %}" class="btn btn-warning">Query Memories</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const refreshTokenButton = document.getElementById('refresh-token');
        if (refreshTokenButton) {
            refreshTokenButton.addEventListener('click', function() {
                fetch('{% url "refresh_token" %}')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.location.reload();
                        } else {
                            alert('Failed to refresh token: ' + data.error);
                        }
                    })
                    .catch(error => {
                        alert('Error: ' + error);
                    });
            });
        }
    });
</script>
{% endblock %}
